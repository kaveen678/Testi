<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cricheart - Live TV Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #0c0c0c;
            --card-color: #181818;
            --accent: #ff003c; /* Cricheart Theme Red */
            --text: #ffffff;
            --secondary-text: #aaaaaa;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding-bottom: 50px;
        }

        /* Header & Logo Section */
        header {
            background: #000;
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #222;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: 1px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i { color: var(--accent); font-size: 28px; }
        .logo span { color: var(--accent); }

        /* Video Player */
        .main-player {
            width: 100%;
            max-width: 1000px;
            margin: 20px auto;
            background: #000;
            aspect-ratio: 16/9;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        video { width: 100%; height: 100%; outline: none; }

        /* Controls & Search */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }

        .search-container { margin: 20px 0; position: relative; }
        .search-bar {
            width: 100%;
            padding: 14px 20px;
            background: var(--card-color);
            border: 1px solid #333;
            border-radius: 30px;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }

        .categories {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 15px;
            scrollbar-width: none;
        }

        .cat-btn {
            background: #252525;
            border: none;
            color: white;
            padding: 8px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: 0.2s;
        }

        .cat-btn.active, .cat-btn:hover { background: var(--accent); }

        /* Channel Grid Style (Matches your Screenshot) */
        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .channel-card {
            background: var(--card-color);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, border 0.2s;
            border: 1.5px solid transparent;
        }

        .channel-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .channel-card img {
            height: 60px;
            max-width: 100%;
            object-fit: contain;
            margin-bottom: 12px;
        }

        .channel-card .name {
            display: block;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .channel-card .group {
            font-size: 12px;
            color: var(--secondary-text);
            margin-top: 4px;
        }

        /* Footer */
        footer {
            margin-top: 60px;
            padding: 40px 20px;
            text-align: center;
            background: #050505;
            border-top: 1px solid #1a1a1a;
        }

        .footer-content h3 { color: var(--accent); margin-bottom: 5px; }
        .footer-content p { color: var(--secondary-text); font-size: 13px; }

    </style>
</head>
<body>

<header>
    <div class="logo">
        <i class="fas fa-play-circle"></i> CRIC<span>HEART</span>
    </div>
    <div class="time" id="clock" style="font-size: 14px; color: var(--secondary-text);"></div>
</header>

<div class="main-player">
    <video id="video" controls autoplay poster="https://via.placeholder.com/1000x560/000/fff?text=Select+a+Channel+to+Start+Watching"></video>
</div>

<div class="container">
    <div class="search-container">
        <input type="text" id="search" class="search-bar" placeholder="Search 1100+ Channels...">
    </div>

    <div class="categories" id="cat-list">
        <button class="cat-btn active" onclick="filterCategory('All')">All</button>
        <button class="cat-btn" onclick="filterCategory('Sports')">Sports</button>
        <button class="cat-btn" onclick="filterCategory('News')">News</button>
        <button class="cat-btn" onclick="filterCategory('Entertainment')">Entertainment</button>
        <button class="cat-btn" onclick="filterCategory('Movies')">Movies</button>
        <button class="cat-btn" onclick="filterCategory('Music')">Music</button>
        <button class="cat-btn" onclick="filterCategory('Kids')">Kids</button>
    </div>

    <h3 id="count-text" style="margin-top:25px; font-weight: 400;">Channels (Loading...)</h3>
    <div class="channel-grid" id="channel-grid">
        </div>
</div>

<footer>
    <div class="footer-content">
        <h3>CRICHEART LIVE</h3>
        <p>Premium IPTV Experience | Auto-Update Playlist</p>
        <p style="margin-top: 15px;">Â© 2026 Cricheart TV. All Rights Reserved.</p>
    </div>
</footer>

<script>
    const m3uUrl = 'https://raw.githubusercontent.com/pk3011/pkjtv/refs/heads/main/jtv.m3u';
    let allChannels = [];

    // Player Logic (Quality Detection)
    function playM3U8(url) {
        const video = document.getElementById('video');
        if (Hls.isSupported()) {
            const hls = new Hls({
                capLevelToPlayerSize: true, // Auto Quality
                debug: false
            });
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.addEventListener('loadedmetadata', () => video.play());
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Load M3U with Proxy to bypass CORS on Hosting
    async function fetchPlaylist() {
        try {
            // Using a public CORS proxy for reliable hosting performance
            const proxy = 'https://api.allorigins.win/raw?url=';
            const response = await fetch(proxy + encodeURIComponent(m3uUrl));
            const data = await response.text();
            parseM3U(data);
        } catch (err) {
            console.error("Error loading playlist", err);
            document.getElementById('count-text').innerText = "Failed to load channels. Please refresh.";
        }
    }

    function parseM3U(data) {
        const lines = data.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].includes('#EXTINF')) {
                const info = lines[i];
                const url = lines[i + 1]?.trim();
                
                const name = info.split(',')[1] || "Unknown";
                const logo = info.match(/tvg-logo="([^"]+)"/)?.[1] || "";
                const group = info.match(/group-title="([^"]+)"/)?.[1] || "General";

                if (url && url.startsWith('http')) {
                    allChannels.push({ name, url, logo, group });
                }
            }
        }
        renderChannels(allChannels);
        document.getElementById('count-text').innerText = `Channels (${allChannels.length})`;
    }

    function renderChannels(list) {
        const grid = document.getElementById('channel-grid');
        grid.innerHTML = list.map(ch => `
            <div class="channel-card" onclick="playM3U8('${ch.url}')">
                <img src="${ch.logo}" onerror="this.src='https://via.placeholder.com/150?text=TV'">
                <span class="name">${ch.name}</span>
                <span class="group">${ch.group}</span>
            </div>
        `).join('');
    }

    // Filter Logic
    function filterCategory(cat) {
        document.querySelectorAll('.cat-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        const filtered = (cat === 'All') 
            ? allChannels 
            : allChannels.filter(ch => ch.group.toLowerCase().includes(cat.toLowerCase()));
        
        renderChannels(filtered);
    }

    // Search Logic
    document.getElementById('search').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(term));
        renderChannels(filtered);
    });

    // Clock for Header
    setInterval(() => {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString();
    }, 1000);

    fetchPlaylist();
</script>

</body>
</html>